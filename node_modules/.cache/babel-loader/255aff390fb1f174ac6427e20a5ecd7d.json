{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/slipw/OneDrive/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u0438/Project-Yulia/messanger-react/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"C:/Users/slipw/OneDrive/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u0438/Project-Yulia/messanger-react/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"C:/Users/slipw/OneDrive/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u0438/Project-Yulia/messanger-react/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/slipw/OneDrive/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u0438/Project-Yulia/messanger-react/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{createContext}from\"react\";import{useState}from\"react\";import{useHttp}from\"../hooks/UseHttpHook\";import{jsx as _jsx}from\"react/jsx-runtime\";export var localContext=/*#__PURE__*/createContext();function ContextLocalStorage(props){var _useState=useState(),_useState2=_slicedToArray(_useState,2),messageData=_useState2[0],setMessageData=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),messages=_useState4[0],setMessages=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),userData=_useState6[0],setUserData=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),lastUserMessages=_useState8[0],setLastUserMessages=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),originalData=_useState10[0],setOriginalData=_useState10[1];var _useHttp=useHttp(),request=_useHttp.request;function getItem(id,image,name){setMessageData({id:id,image:image,name:name});return{id:id,image:image,name:name};}var getMessageData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _getData;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(messageData!==null&&messageData!==void 0&&messageData.name)){_context.next=5;break;}_context.next=3;return request(\"/api/auth/message\",\"GET\");case 3:_getData=_context.sent;setMessages(_toConsumableArray(_getData.message));case 5:case\"end\":return _context.stop();}}},_callee);}));return function getMessageData(){return _ref.apply(this,arguments);};}();var getData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var rawResponse;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return request(\"/api/auth/getUserChat\");case 2:rawResponse=_context2.sent;setUserData(rawResponse===null||rawResponse===void 0?void 0:rawResponse.data);getItem(rawResponse===null||rawResponse===void 0?void 0:rawResponse.data[0]._id,rawResponse===null||rawResponse===void 0?void 0:rawResponse.data[0].image,rawResponse===null||rawResponse===void 0?void 0:rawResponse.data[0].name);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function getData(){return _ref2.apply(this,arguments);};}();var getContact=function getContact(){var userMessages=messages.sort(function(a,b){return new Date(b.date)-new Date(a.date);});var lastMessages=[];var names=[];userMessages.map(function(item){if(!names.includes(item.name)){names.push(item.name);lastMessages.push(item);}});lastMessages.map(function(item){return item.image=userData===null||userData===void 0?void 0:userData.find(function(data){return item.name===data.name;}).image;});setLastUserMessages([].concat(lastMessages));setOriginalData([].concat(lastMessages));};return/*#__PURE__*/_jsx(localContext.Provider,{value:{getItem:getItem,messageData:messageData,getMessageData:getMessageData,userData:userData,messages:messages,getData:getData,getContact:getContact,originalData:originalData,lastUserMessages:lastUserMessages,setLastUserMessages:setLastUserMessages},children:props.children});}export default ContextLocalStorage;","map":{"version":3,"names":["createContext","useState","useHttp","localContext","ContextLocalStorage","props","messageData","setMessageData","messages","setMessages","userData","setUserData","lastUserMessages","setLastUserMessages","originalData","setOriginalData","request","getItem","id","image","name","getMessageData","getData","message","rawResponse","data","_id","getContact","userMessages","sort","a","b","Date","date","lastMessages","names","map","item","includes","push","find","children"],"sources":["C:/Users/slipw/OneDrive/Документи/Project-Yulia/messanger-react/client/src/context/MessageContext.js"],"sourcesContent":["import { createContext } from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useHttp } from \"../hooks/UseHttpHook\";\r\nexport const localContext = createContext();\r\n\r\nfunction ContextLocalStorage(props) {\r\n    const [messageData, setMessageData] = useState();\r\n    const [messages, setMessages] = useState([]);\r\n\r\n    const [ userData, setUserData] = useState(null);\r\n    const [lastUserMessages, setLastUserMessages] = useState([]);\r\n    const [originalData, setOriginalData] = useState([]);\r\n\r\n\r\n    const { request } = useHttp();\r\n \r\n\r\n  function getItem(id, image, name) {\r\n    setMessageData({id:id, image:image,name:name})\r\n    return { id, image, name };\r\n  }\r\n\r\n  const getMessageData = async () => {\r\n    if (messageData?.name) {\r\n   const getData = await request(\r\n     `/api/auth/message`,\r\n     \"GET\"\r\n   );\r\n   setMessages([...getData.message])\r\n }};\r\n\r\n    const getData = async () => {\r\n      const rawResponse = await request(`/api/auth/getUserChat`);\r\n      setUserData(rawResponse?.data);\r\n      getItem(rawResponse?.data[0]._id, rawResponse?.data[0].image, rawResponse?.data[0].name)\r\n    };\r\n\r\n    const getContact = () => {\r\n    const userMessages = messages.sort((a, b) => new Date(b.date) - new Date(a.date));\r\n    const lastMessages = [];\r\n    const names = [];\r\n    userMessages.map(item => {\r\n      if (!names.includes(item.name)) {\r\n        names.push(item.name);\r\n        lastMessages.push(item);\r\n      }\r\n    });\r\n    lastMessages.map(item => item.image = userData?.find(data => item.name === data.name).image);\r\n    setLastUserMessages([...lastMessages])\r\n    setOriginalData([...lastMessages])\r\n}\r\n  \r\n  return (\r\n    <localContext.Provider value={{ getItem, messageData, getMessageData,userData, messages, getData, getContact, originalData,lastUserMessages, setLastUserMessages}}>\r\n      {props.children}\r\n    </localContext.Provider>\r\n  );\r\n}\r\n\r\nexport default ContextLocalStorage;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}