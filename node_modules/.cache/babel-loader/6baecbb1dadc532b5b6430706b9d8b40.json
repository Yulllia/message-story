{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/slipw/OneDrive/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u0438/Project-Yulia/messanger-react/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/slipw/OneDrive/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u0438/Project-Yulia/messanger-react/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{localContext}from\"../../context/MessageContext\";import{useContext,useEffect,useRef}from\"react\";import ChatInput from\"../chatInput/ChatInput\";import{useHttp}from\"../../hooks/UseHttpHook\";import Spinner from\"../../components/Spinner\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function ChatMessage(){var _useContext=useContext(localContext),messageData=_useContext.messageData,getMessageData=_useContext.getMessageData,messages=_useContext.messages;var _useHttp=useHttp(),request=_useHttp.request;var scrollRef=useRef();var userMessages=messages.sort(function(a,b){return new Date(a.date)-new Date(b.date);});useEffect(function(){getMessageData();},[messageData===null||messageData===void 0?void 0:messageData.name]);useEffect(function(){var _scrollRef$current;(_scrollRef$current=scrollRef.current)===null||_scrollRef$current===void 0?void 0:_scrollRef$current.scrollIntoView({behavior:\"smooth\"});},[messages]);function handleSendMsg(_x,_x2){return _handleSendMsg.apply(this,arguments);}function _handleSendMsg(){_handleSendMsg=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(message,name){var dataResponse;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return request(\"/api/auth/message\",\"POST\",JSON.stringify({from:\"myself\",name:messageData.name,message:message,date:new Date()})).then(function(){return getMessageData();});case 2:_context2.next=4;return request(\"https://api.chucknorris.io/jokes/random\",\"GET\");case 4:dataResponse=_context2.sent;if(dataResponse!==null&&dataResponse!==void 0&&dataResponse.value){setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return request(\"/api/auth/message\",\"POST\",JSON.stringify({from:messageData.name,name:messageData.name,message:dataResponse===null||dataResponse===void 0?void 0:dataResponse.value,date:new Date()})).then(function(){return getMessageData();});case 2:case\"end\":return _context.stop();}}},_callee);})),10000);}case 6:case\"end\":return _context2.stop();}}},_callee2);}));return _handleSendMsg.apply(this,arguments);}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat-messages\",children:userMessages?userMessages.map(function(message,i){if(message.name===(messageData===null||messageData===void 0?void 0:messageData.name)){var timeElapsed=message.date;var today=new Date(timeElapsed);var current=today.toLocaleDateString('en-US',{hour:'numeric',minute:'numeric',hour12:true});return/*#__PURE__*/_jsxs(\"div\",{ref:scrollRef,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"message \".concat(message.from===\"myself\"?\"sended\":\"recieved\"),children:[message.from===\"myself\"&&/*#__PURE__*/_jsx(\"img\",{src:messageData.image,alt:\"person\"}),/*#__PURE__*/_jsx(\"div\",{className:\"content\",children:/*#__PURE__*/_jsx(\"p\",{children:message.message})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"message date \".concat(message.from===\"myself\"?\"sended\":\"recieved\"),children:current})]},i);}}):/*#__PURE__*/_jsx(Spinner,{})}),/*#__PURE__*/_jsx(ChatInput,{handleSendMsg:handleSendMsg})]});}export default ChatMessage;","map":{"version":3,"names":["localContext","useContext","useEffect","useRef","ChatInput","useHttp","Spinner","ChatMessage","messageData","getMessageData","messages","request","scrollRef","userMessages","sort","a","b","Date","date","name","current","scrollIntoView","behavior","handleSendMsg","message","JSON","stringify","from","then","dataResponse","value","setTimeout","map","i","timeElapsed","today","toLocaleDateString","hour","minute","hour12","image"],"sources":["C:/Users/slipw/OneDrive/Документи/Project-Yulia/messanger-react/client/src/pages/message/ChatMessage.jsx"],"sourcesContent":["import { localContext } from \"../../context/MessageContext\";\r\nimport { useContext, useEffect, useRef } from \"react\";\r\nimport ChatInput from \"../chatInput/ChatInput\";\r\nimport { useHttp } from \"../../hooks/UseHttpHook\";\r\nimport Spinner from \"../../components/Spinner\";\r\n\r\nfunction ChatMessage() {\r\n  const { messageData, getMessageData, messages } = useContext(localContext);\r\n  const { request } = useHttp();\r\n  const scrollRef = useRef();\r\n  const userMessages = messages.sort((a, b) => new Date(a.date) - new Date(b.date));\r\n\r\n  useEffect(() => {\r\n    getMessageData();\r\n  }, [messageData?.name]);\r\n\r\n  useEffect(() => {\r\n    scrollRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  async function handleSendMsg(message, name) {\r\n    await request(\r\n      \"/api/auth/message\",\r\n      \"POST\",\r\n      JSON.stringify({\r\n        from: \"myself\",\r\n        name: messageData.name,\r\n        message: message,\r\n        date: new Date(),\r\n      })\r\n    ).then(() => getMessageData());\r\n\r\n    const dataResponse = await request(\r\n      \"https://api.chucknorris.io/jokes/random\",\r\n      \"GET\"\r\n    );\r\n\r\n    if (dataResponse?.value) {\r\n      setTimeout(async () => {\r\n        await request(\r\n          \"/api/auth/message\",\r\n          \"POST\",\r\n          JSON.stringify({\r\n            from: messageData.name,\r\n            name: messageData.name,\r\n            message: dataResponse?.value,\r\n            date: new Date(),\r\n          })\r\n        ).then(() => getMessageData());\r\n      }, 10000);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"chat-messages\">\r\n        {userMessages ? userMessages.map((message, i) => {\r\n          if (message.name === messageData?.name) {\r\n            const timeElapsed = message.date;\r\n            const today = new Date(timeElapsed);\r\n            const current =\r\n              today.toLocaleDateString('en-US',{hour:'numeric', minute:'numeric', hour12:true});\r\n            return (\r\n              <div ref={scrollRef} key={i}>\r\n                <div\r\n                  className={`message ${\r\n                    message.from === \"myself\" ? \"sended\" : \"recieved\"\r\n                  }`}\r\n                >\r\n                  {message.from === \"myself\" && (\r\n                    <img src={messageData.image} alt=\"person\" />\r\n                  )}\r\n                  <div className=\"content\">\r\n                    <p>{message.message}</p>\r\n                  </div>\r\n                </div>\r\n                <div\r\n                  className={`message date ${\r\n                    message.from === \"myself\" ? \"sended\" : \"recieved\"\r\n                  }`}\r\n                >\r\n                  {current}\r\n                </div>\r\n              </div>\r\n            );\r\n          }\r\n        }) : (\r\n            <Spinner/>\r\n        )}\r\n      </div>\r\n      <ChatInput handleSendMsg={handleSendMsg} />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default ChatMessage;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}